generator client {
  provider     = "prisma-client"
  output       = "../../../common/prisma"
  moduleFormat = "esm"
  runtime      = "bun"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Building {
  id   String @id @default(cuid())
  name String

  floors Floor[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Floor {
  id String @id @default(cuid())

  level     Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  rooms  Room[]
  images FloorImage[]

  building   Building @relation(fields: [buildingId], references: [id], onDelete: Cascade)
  buildingId String

  createdBy   User   @relation("UserFloors", fields: [createdById], references: [id], onDelete: Cascade)
  createdById String
}

model Room {
  id String @id @default(cuid())

  floor   Floor  @relation(fields: [floorId], references: [id], onDelete: Cascade)
  floorId String

  name      String
  number    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  x      Float @default(0)
  y      Float @default(0)
  width  Float @default(0)
  height Float @default(0)

  doorX Float @default(0)
  doorY Float @default(0)

  fromPaths Path[] @relation("RoomFrom")
  toPaths   Path[] @relation("RoomTo")
}

model Path {
  id String @id @default(cuid())

  fromRoom   Room   @relation("RoomFrom", fields: [fromRoomId], references: [id], onDelete: Cascade)
  fromRoomId String
  toRoom     Room   @relation("RoomTo", fields: [toRoomId], references: [id], onDelete: Cascade)
  toRoomId   String

  instructionSet InstructionSet?

  anchors PathAnchor[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model InstructionSet {
  id     String @id @default(cuid())
  path   Path   @relation(fields: [pathId], references: [id], onDelete: Cascade)
  pathId String @unique

  descriptiveInstructions String[]
  conciseInstructions     String[]
}

model UserSettings {
  id        String   @id @default(uuid())
  userId    String   @unique
  stepSize  StepSize @default(MEDIUM)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum StepSize {
  SMALL
  MEDIUM
  LARGE
}

// format of instruction
// Facing straight, go ahead {{10}}, turn left and move {{20}}

model PathAnchor {
  id    String @id @default(cuid())
  index Int

  xCoords Float
  yCoords Float
  path    Path   @relation(fields: [pathId], references: [id], onDelete: Cascade)
  pathId  String
}

model FloorImage {
  id String @id @default(cuid())

  floor   Floor  @relation(fields: [floorId], references: [id], onDelete: Cascade)
  floorId String

  imageUrl String // Relative path to uploaded image

  // Position on canvas
  x Float @default(0)
  y Float @default(0)

  // Scale factor (1.0 = 1:1 pixel mapping)
  scale Float @default(1.0)

  // Transparency (0.0 = fully transparent, 1.0 = fully opaque)
  opacity Float @default(0.5)

  // Z-index for layering multiple images
  zIndex Int @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
